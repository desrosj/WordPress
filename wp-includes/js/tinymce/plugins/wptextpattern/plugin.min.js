!function(g,p){g.Env.ie&&g.Env.ie<9||g.PluginManager.add("wptextpattern",function(i){var d,t=g.util.VK,f=[{regExp:/^[*-]\s/,cmd:"InsertUnorderedList"},{regExp:/^1[.)]\s/,cmd:"InsertOrderedList"}],c=[{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:">",format:"blockquote"},{regExp:/^(-){3,}$/,element:"hr"}],s=[{start:"`",end:"`",format:"code"}],l=[];function u(e){var t,n=i.dom.getParent(e,"p");if(n){for(;(t=n.firstChild)&&3!==t.nodeType;)n=t;if(t)return t.data||(t=t.nextSibling&&3===t.nextSibling.nodeType?t.nextSibling:null),t}}g.each(s,function(e){g.each((e.start+e.end).split(""),function(e){-1===g.inArray(l,e)&&l.push(e)})}),i.on("selectionchange",function(){d=null}),i.on("keydown",function(e){(d&&27===e.keyCode||"space"===d&&e.keyCode===t.BACKSPACE)&&(i.undoManager.undo(),e.preventDefault(),e.stopImmediatePropagation()),e.keyCode!==t.ENTER||t.modifierPressed(e)||function(){var e,t,n,a=i.selection.getRng().startContainer,r=u(a),o=c.length;if(!r)return;e=r.data;for(;o--;)if(c[o].start){if(0===e.indexOf(c[o].start)){t=c[o];break}}else if(c[o].regExp&&c[o].regExp.test(e)){t=c[o];break}if(!t)return;if(r===a&&g.trim(e)===t.start)return;i.once("keyup",function(){i.undoManager.add(),i.undoManager.transact(function(){var e;t.format?(i.formatter.apply(t.format,{},r),r.replaceData(0,r.data.length,(e=r.data.slice(t.start.length))?e.replace(/^\s+/,""):"")):t.element&&(n=r.parentNode&&r.parentNode.parentNode)&&n.replaceChild(document.createElement(t.element),r.parentNode)}),p(function(){d="enter"})})}()},!0),i.on("keyup",function(e){e.keyCode!==t.SPACEBAR||e.ctrlKey||e.metaKey||e.altKey?47<e.keyCode&&!(91<=e.keyCode&&e.keyCode<=93)&&function(){var e,a,t,n=i.selection.getRng(),r=n.startContainer,o=n.startOffset;if(!r||3!==r.nodeType||!r.data.length||!o)return;if(-1===g.inArray(l,r.data.charAt(o-1)))return;if(e=function(e){for(var t,n=s.length;n--;)if(a=s[n],-1!==(t=e.data.indexOf(a.end)))return t}(r),n=r.data.lastIndexOf(a.end),e===n||-1===n)return;if(n-e<=a.start.length)return;if(-1!==r.data.slice(e+a.start.length,n).indexOf(a.start.slice(0,1)))return;(n=i.formatter.get(a.format))&&n[0].inline&&(i.undoManager.add(),i.undoManager.transact(function(){r.insertData(o,"​"),r=r.splitText(e),t=r.splitText(o-e),r.deleteData(0,a.start.length),r.deleteData(r.data.length-a.end.length,a.end.length),i.formatter.apply(a.format,{},r),i.selection.setCursorLocation(t,1)}),p(function(){d="space",i.once("selectionchange",function(){var e;t&&-1!==(e=t.data.indexOf("​"))&&t.deleteData(e,e+1)})}))}():function(){var n,a,r=i.selection.getRng(),o=r.startContainer;if(!o||u(o)!==o)return;n=o.parentNode,a=o.data,g.each(f,function(e){var t=a.match(e.regExp);if(t&&r.startOffset===t[0].length)return i.undoManager.add(),i.undoManager.transact(function(){o.deleteData(0,t[0].length),n.innerHTML||n.appendChild(document.createElement("br")),i.selection.setCursorLocation(n),i.execCommand(e.cmd)}),p(function(){d="space"}),!1})}()})})}(window.tinymce,window.setTimeout);